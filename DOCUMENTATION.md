API OVERVIEW
===============


Documentation
-------------

- Code examples, field names, etc. are `highlighted in yellow`.
- Important notes are *highlighted in green*.


Specifications
--------------

- Base URI:
	- Production: http://api.americancortex.com/ *private*
	- Internal Development: http://api.privatecortex.com/ *private*
- Current API Version: 0.70
- Request Formats: JSON
- Response Formats: JSON


Authentication
--------------

- Basic HTTP Authentication via the web server is currenlty implemented.
- Authentication requires a username and password specified in the header of each request.
	- `curl -u user:pass -X GET 'http://api.privatecortex.com/companies/2'`
- You must contact TBJ to get a username and password.

### User Types
- `root` access to all endpoints
- `client` access to all non-utility endpoints
- `consumer` access to most GET endpoints


Specifications
--------------

- testing

Response Object
---------------

The API returns a JSON response that always includes an HTTP Response `status` and a `user_message`.  Some endpoints will also include a `data` field ( eg. a company profile, search results, a new contact that was just created ).  The `data` field will usually be an object or an array of objects.

An `error_message` will only be returned when the API is in development mode.  This message will often include an internal process error or exception message ( eg. MySQL Error message ).

### Response Object Example

```
{
	"status": 200,
	"user_message": "A user message, generally suitable to display to the client.",
	"error_message": "An error message that should only be seen by developers.",
	"data": {
		"some_field": "some field data",
		"another_field": "some more field data" 
	}
}
```

### HTTP Response Status

- `200` Success
- `201` Created
	- Request was succesful and a resource was created.
	- At least an `id` for the new resource will be returned.
- `202` Accepted
	- Request was succesful, but the response may not be what is expected.
	- The crawling and indexing endpoints sometimes return a `202`. ( eg. The system is asked to index the next company, but all companies have been indexed `/companies/index/` )
- `204` No Content
	- The specified resource was deleted.
- `400` Bad Request
	- Request failed due to bad syntax.
	- Usually a malformed JSON object in the Request Body.
- `403` Forbidden
	- Usually a client is trying to overwrite exisiting data that has a higher source priority than the data being submitted.
	- These requests should probably not be resubmitted.
- `404` Not Found
- `409` Conflict
	- A data validation exception.
	- Data being submitted to the API is probably malformed.


Important Notes
---------------

*READ ALL OF THESE*
	
- In theory, if a request fails, no data will be changed in the database. The system is designed to work this way, but sometimes it doesn't. This is noted in various situations and will be fixed in the future with a tighter control on database queries.
- Data passed to the API via POST and PUT requests that does not match available fields will generally be silently ignored.
- When sending data via a cURL data package, apostrophes should be replaced with `\u0027`.  Escaping JSON is not sufficient when using cURL, as the JSON escaped apostrophe looks like an end of data mark to the cURL interpreter.
	- this can be done in PHP using the `json_encode()` method with some specific options: `json_encode( $data, JSON_HEX_QUOT | JSON_HEX_APOS )`
- When making POST and PUT requests via cURL that are larger than a few KB, the "Expect" header must be disabled to work with the API Webserver. Failure to do so will result in a `417 Expectation Failed` HTTP response.  This is already fixed in the current development version of Lighttpd and will be updated when that version is stable.
	- `cURL -H "Expect:"` will disable the cURL Expect header.


COMPANY DATA
============

Company Object Data Fields
--------------------------
*Apostrophes should be replaced with `\u0027` in JSON passed to the API.*

### Company Object
- `id` *int 11*
- `cage_code` *char 5*
	- must always be exactly five alphanumeric chracters
- `duns_number` *int 9*
	- must always be a nine digit number
- `url` *varchar 255*
	- Include only the scheme, subdomain, and host ( eg. http://www.website.com ).
	- URLs that include any other information will be rejected.
- `url_source_id` *int 11*
- `url_last_updated` *datetime* *generated by the API*
- `name` *varchar 255*
	- Can only contain letters, numbers, and standard punctuation
	- eg. periods, commas, single and double quotes, slashes, dashes, and hyphens
- `name_source_id` *int 11*
- `name_last_updated` *datetime* *generated by the API*
- `legal_business_name` *varchar 255*
	- Can only contain letters, numbers, and standard punctuation
	- eg. periods, commas, single and double quotes, slashes, dashes, and hyphens
- `legal_business_name_source_id` *int 11*
- `legal_business_name_last_updated` *datetime* *generated by the API*
- `division` *varchar 255*
	- Can only contain letters, numbers, and standard punctuation
	- eg. periods, commas, single and double quotes, slashes, dashes, and hyphens
- `division_source_id` *int 11*
- `division_last_updated` *datetime* *generated by the API*
- `description` *text ( 65,535 )*
- `description_source_id` *int 11*
- `description_last_updated` *datetime* *generated by the API*
- `terms` *array* *not available in V1.0*
	- This field is an agregation of terms from various sources for the purpose of filtering and facetting. It only exists in Elasticsearch and cannot be retrieved or updated in the Company object.
	- This field contains terms extracted from all company file objects: meta `keywords`, `anchor_texts`, `h1_tags`, `h2_tags`, `h3_tags`, and `url_words`.
- `employees` *varchar 255*
- `employees_source_id` *int 11*
- `employees_last_updated` *datetime* *generated by the API*
- `sales` *varchar 255*
- `sales_source_id` *int 11*
- `sales_last_updated` *datetime* *generated by the API*
- `year_founded` *int 4*
	- Must always be a four digit integer ( eg. 1964, 2012 ).
- `year_founded_source_id` *int 11*
- `year_founded_last_updated` *datetime* *generated by the API*
- `logo_file_id` *int 11*

#### arrays of extended company data
- `contacts` *array*
	- contains an unlimited number of contact objects
- `locations` *array*
	- contains an unlimited number of location objects
- `subcategories` *array*
	- contains an unlimited number of subcategory objects
- `industries` *array*
	- contains an unlimited number of industry objects
- `certifications` *array*
	- contains an unlimited number of certification objects
- `business_types` *array*
	- contains an unlimited number of business_type objects
- `manufacturing_business_types` *array*
	- contains an unlimited number of manufacturing_business_type objects
- `diversity_business_types` *array*
	- contains an unlimited number of diversity_business_type objects
- `social_links` *array* *under development*
	- contains an unlimited number of social_link objects

#### internal company processing data
*These fields are generally only available via GET requests.*

- `crawl` *bool*
- `crawling` *bool*
- `last_crawled` *datetime*
- `index` *bool*
- `indexed` *bool*
- `indexing` *bool*
- `last_indexed` *datetime*
- `private` *bool*
- `junk` *bool*

### Contact Object
- `title` *varchar 255*
- `description` *text ( 65,535 Characters )*
- `person` *varchar 255*
- `position` *varchar 255*
- `email` *varchar 255*
	- must contain an @ symbol ( the only validation performed )
- `phone` *varchar 255*
	- Phone numbers can only contain numbers, spaces, periods, "ext:", and the following characters - + ( )
	- Extensions should be specified by including "ext:" followed by the extension numbers
- `fax` *varchar 255*
	- Fax numbers can only contain numbers, spaces, periods, "ext:", and the following characters - + ( )
- `raw_address` *varchar 255*
	- raw addresses are automatically broken down into relevant parts by a geolocation process
	- these fields include `street`, `city`, `county`, `state`, `country`, `postal_code`, `lat`, and `lon`
- `source_id` *int 11*
- `last_updated` *datetime* *generated by the API*
- `last_geocoded` *datetime* *generated by the API*

#### Conact Object Data Generated From The Raw Address
*US Address Codes are FIPS Codes*

- `street` *varchar 255*
- `city` *varchar 255*
- `city_code` *var_chat 255* 
- `county` *varchar 255*
- `county_code` *var_chat 255* 
- `constituency` *varchar 255*
- `constituency_code`*var_chat 255* 
- `state` *varchar 255*
- `state_code` *var_chat 255* 
- `country` *varchar 255*
- `country_code` *var_chat 255* 
- `postal_code` *varchar 255*
- `lat` *float 10,6*
- `lon` *float 10,6*

### Location Object
- `title` *varchar 255*
- `description` *text ( 65,535 )*
- `raw_address` *varchar 255*
	- raw addresses are automatically broken down into relevant parts by a geolocation process
	- these fields include `street`, `city`, `county`, `state`, `country`, `postal_code`, `lat`, and `lon`
- `headquarters` *boolean*
- `research_and_development` *boolean*
- `manufacturing` *boolean*
- `distribution` *boolean*
- `sales` *boolean*
- `retail` *boolean*
- `source_id` *int 11*
- `last_updated` *datetime* *generated by the API*
- `last_geocoded` *datetime* *generated by the API*

#### Location Object Data Generated From The Raw Address
*US Address Codes are FIPS Codes*

- `street` *varchar 255*
- `city` *varchar 255*
- `city_code` *var_chat 255* 
- `county` *varchar 255*
- `county_code` *var_chat 255* 
- `constituency` *varchar 255*
- `constituency_code`*var_chat 255* 
- `state` *varchar 255*
- `state_code` *var_chat 255* 
- `country` *varchar 255*
- `country_code` *var_chat 255* 
- `postal_code` *varchar 255*
- `lat` *float 10,6*
- `lon` *float 10,6*

### Industry Object
- `term` *varchar 255*
- `term_id` *int 11*
- `company_id` *int 11*
- `score` *int 11*
	- must be a number between 0 and 4294967295 ( inclusive )
- `raw_score` *big_int 20*
	- must be a number between 0 and 18446744073709551615 ( inclusive )
- `verified` *boolean*
- `source_id` *int 11*
- `last_updated` *datetime* *generated by the API*

### Certification Object
- `term` *varchar 255*
- `term_id` *int 11*
- `company_id` *int 11*
- `score` *int 11*
	- must be a number between 0 and 4294967295 ( inclusive )
- `raw_score` *big_int 20*
	- must be a number between 0 and 18446744073709551615 ( inclusive )
- `verified` *boolean*
- `source_id` *int 11*
- `last_updated` *datetime* *generated by the API*

### Business Type Object
- `term` *varchar 255*
- `term_id` *int 11*
- `company_id` *int 11*
- `score` *int 11*
	- must be a number between 0 and 4294967295 ( inclusive )
- `raw_score` *big_int 20*
	- must be a number between 0 and 18446744073709551615 ( inclusive )
- `verified` *boolean*
- `source_id` *int 11*
- `last_updated` *datetime* *generated by the API*

### Manufacturing Business Type Object
- Same as Business Type Object, but only contains Manufacturing Business Types.

### Diversity Business Type Object
- Same as Business Type Object, but only contains Diversity Business Types.

### Categories Object
*not available in V1.0*

### Subcategories Object ( Products & Services )
- `term` *varchar 255*
- `term_id` *int 11*
- `company_id` *int 11*
- `unspsc_code *int(11)*
- `unspsc_segment_code` *int(2)*
- `unspsc_family_code` *int(2)*
- `unspsc_class_code` *int(2)*
- `unspsc_commodity_code` *int(2)*
- `unspsc_segment` *boolean*
- `unspsc_family` *boolean*
- `unspsc_class` *boolean*
- `unspsc_commodity` *boolean*
- `score` *int 11*
	- must be a number between 0 and 4294967295 ( inclusive )
- `raw_score` *big_int 20*
	- must be a number between 0 and 18446744073709551615 ( inclusive )
- `verified` *boolean*
- `source_id` *int 11*
- `last_updated` *datetime* *generated by the API*

### Cities Serviced Object
*not available in V1.0*

### States Serviced Object
- `term` *varchar 255*
- `term_id` *int 11*
- `company_id` *int 11*
- `usps_ansi_fips_alpha` *char(2)*
- `ansi_fips_numeric` *int(2)*
- `iso_3166_2` *char(5)*
- `score` *int 11*
	- must be a number between 0 and 4294967295 ( inclusive )
- `raw_score` *big_int 20*
	- must be a number between 0 and 18446744073709551615 ( inclusive )
- `verified` *boolean*
- `source_id` *int 11*
- `last_updated` *datetime* *generated by the API*

### Countries Serviced Object
- `term` *varchar 255*
- `term_id` *int 11*
- `company_id` *int 11*
- `iso_3166_1_alpha_2` *char(2)*
- `iso_3166_1_alpha_3` *char(3)*
- `iso_3166_1_numeric` *int(3)*
- `fips` *cha(2)*
- `score` *int 11*
	- must be a number between 0 and 4294967295 ( inclusive )
- `raw_score` *big_int 20*
	- must be a number between 0 and 18446744073709551615 ( inclusive )
- `verified` *boolean*
- `source_id` *int 11*
- `last_updated` *datetime* *generated by the API*

### Partners Object
*not available in V1.0*

### Social Link Object
- `id` *int 11*
- `company_id` *int 11*
- `title` *var_char 255*
- `url` *var_char 255*
- `score` *int 11*
	- must be a number between 0 and 4294967295 ( inclusive )
- `raw_score` *big_int 20*
	- must be a number between 0 and 18446744073709551615 ( inclusive )
- `verified` *boolean*
- `source_id` *int 11*
- `last_updated` *datetime* *generated by the API*

### Company Data Sources
A list of active Cortex API sources can be retrieved by making a GET request to `/companies/sources/`

A `source_id` is required for a veriety of company data. Sometimes the source id will have the spacific field name as a prefix ( eg. `url_source_id` ). Source IDs allow tracking of the origin of data in the system ( scraped from a website, imported from a partner, inputted by a user, etc. ). Sources are an attempt to allow data in the system to constantly be updated via various automated sources without overwriting more accurate or verified data.

- Each source has a priority, and sources with a lower priority cannot overwrite sources with a higher priority.
- Sources with the same priority are able to overwrite each other ( eg. two users from the same company ).
- The update will fail when the provided `source_id` has a lower priority than the `source_id` already in the system.


Get Company Data
----------------

### Get a Default Company Profile ( GET )

Company profiles can be retrieved using a Cortex `id`, a `cage_code`, or `duns_number`. The system defaults to using a Cortex `id` if no `id_type` is specified in the URI.

- by Cortex ID ( default ): `/companies/:id`
	- One can also explicity specify a Cortex `id`
	- `/companies/:id?id_type=cortex_id`
- by Cage Code: `/companies/:id?id_type=cage_code`
- by DUNS Number: `/companies/:id?id_type=duns_number`

### Get a Detailed Company Profile ( GET )

Detailed company profiles can be retrieved by appending `fields` to the URI request.  Detailed profiles are requested using a Cortex `id` by default, but can also be requested using a `cage_code`, or `duns_number` by appending an `id_type` to the URI.

- by Cortex ID ( default ): `/companies/:id`
- by Cage Code: `/companies/:id?id_type=cage_code`
- by DUNS Number: `/companies/:id?id_type=duns_number`

#### Detailed Company Profile Fields

- Fields should be supplied as a comma deliminated list with no spaces.
- Fields can be specified individually or together, and in any order.
- Allowed Fields:
	- `files` *under development*
		- only returns the file ids
		- file profiles need to be retrieved from the `/files/:id` endpoint
	- `contacts`
	- `locations`
	- `industries`
	- `business_types`
	- `manufacturing_business_types`
	- `diversity_business_types`
	- `certifications`
	- `social_links`
	- `categories` *not available in V1.0*
	- `subcategories`
	- `cities_serviced` *not available in V1.0*
	- `states_serviced`
	- `countries_serviced`

### Get Company Category Options ( GET )
*not availabe in V1.0*
Make a GET request to `/companies/categories/`.

### Get Company Subcategory Options ( GET )
*under development*
Make a GET request to `/companies/subcategories/`.

### Get Company Industry Options ( GET )
Make a GET request to `/companies/industries/`.

### Get Company Business Type Options ( GET )
Make a GET request to `/companies/business_types/`.
- Diversity and Manufacturing Business Types will all be returned with this request, and cannot be requested individually.

### Get Company Certification Options ( GET )
Make a GET request to `/companies/certifications/`.

### Get Company Source Options ( GET )
Make a GET request to `/companies/sources/`.

### Get Cities Options ( GET )
*not availabe in V1.0*
Make a GET request to `/companies/cities/`. This returns all the Cities in the system.

### Get State Options ( GET )
Make a GET request to `/companies/states/`. This returns all the States in the system.

### Get Country Options ( GET )
Make a GET request to `/companies/countries/`. This returns all the Countries in the system.


Create Company Data
-------------------

*The "expect" header needs to be disabled with large data packages ( Lighttpd problem in V1.4 ).*

*Apostrophes should be replaced with `\u0027` in JSON passed to the API.*

### Create a Company ( POST )

Make a POST request to `/companies/` and append a data package consisting of a JSON company object to create a company. The company object may contain basic company data and an unlimited number of locations & contacts. This allows a single call to be made to the API to generate a new and complete company. In contrast, updates need to be done to individual parts ( contacts, locations, etc. ).

*In general, one should check for potential duplicate companies using the `/companies/duplicates/` endpoint before attempting to create a new company.*

#### Create a Company Fields

- `id` *required*
	- If no `id` is specified, an `id` will be created.
	- If an `id` is specified, the system will attempt to create a company with that `id`.
	- If a specified `id` is already in use, creation will fail.
- `name` *required* and requires a `name_source_id` *source id must exist*
- `legal_business_name` requires a `legal_business_name_source_id` *source id must exist*
- `division` requires a `division_source_id` *source id must exist*
- `cage_code`
- `duns_number`
- `url` requires `url_source_id` *source id must exist*
- `name` requires `name_source_id` *source id must exist*
- `description` requires `description_source_id` *source id must exist*
- `employees` requires `employees_source_id` *source id must exist*
- `sales` requires `sales_source_id` *source id must exist*
- `year_founded` requires `year_founded_source_id` *source id must exist*
- contacts as an array of contact objects
	- `id` *ignored*
	- `source_id` *required* *must exist*
	- `company_id` *ignored*
	- `title`
	- `description`
	- `person`
	- `position`
	- `email`
	- `phone`
	- `fax`
	- `raw_address`
- locations as an array of location objects
	- `id` *ignored*
	- `source_id` *required* *must exist*
	- `company_id` *ignored*
	- `title`
	- `description`
	- `raw_address` *required*
	- `headquarters`
	- `research_and_development`
	- `manufacturing`
	- `distribution`
	- `sales`
	- `retail`
- social links as an array of social link objects
	- `id` *ignored*
	- `company_id` *ignored*
	- `title` *required*
	- `url` *required*
	- `source_id` *required* *must exist*
	- `score`
	- `verified`
- subcategories as an array of subcategory objects
	- `company_id` *ignored*
	- `term_id` *required* *must exist*
	- `source_id` *required* *must exist*
	- `score`
	- `verified`
- state serviced as an array of states_serviced objects
	- `company_id` *ignored*
	- `term_id` *required* *must exist*
	- `source_id` *required* *must exist*
	- `score`
	- `verified`
- countries serviced as an array of country_serviced objects
	- `company_id` *ignored*
	- `term_id` *required* *must exist*
	- `source_id` *required* *must exist*
	- `score`
	- `verified`
- industries as an array of industry objects
	- `company_id` *ignored*
	- `term_id` *required* *must exist*
	- `source_id` *required* *must exist*
	- `score`
	- `verified`
- certifications as an array of certification objects
	- `company_id` *ignored*
	- `term_id` *required* *must exist*
	- `source_id` *required* *must exist*
	- `score`
	- `verified`
- business types as an array of business type objects
	- `company_id` *ignored*
	- `term_id` *required* *must exist*
	- `source_id` *required* *must exist*
	- `score`
	- `verified`

#### Create a Company Duplicate Prevention
The API will attempt to find duplicate companies before creating a new one.

- CAGE Code Comparison: If the provided `cage_code` matches a company already in the system, creation will fail.
- DUNS Number Comparison: If the provided duns_number` matches a company already in the system, creation will fail.

#### Create a Company cURL Example

```
curl -H "Expect:" -u user:pass -X POST 'http://api.privatecortex.com/companies/' -d '
{
	"id": 145,
    "cage_code": "abc12",
    "duns_number": 123456789,
    "url": "http://www.website.com",
    "url_source_id": 1,
    "name": "Company Name",
    "name_source_id": 1,
    "legal_business_name": "Legal Business Name",
    "legal_business_name_source_id": 1,
    "division": "Company Division",
    "division_source_id": 1,
    "description": "A company description.",
    "description_source_id": 1,
    "employees": "500 or 250-499, etc.",
    "employees_source_id": 1,
	"sales": "$10M or $10,000,000 or $10M - $25M, etc.",
    "sales_source_id": 1,
	"year_founded": 1981,
    "year_founded_source_id": 1,
    "locations": [
        {
            "title": "Location Title",
            "description": "A location description.",
            "raw_address": "7900 Durand Ave. Sturtevant, WI 53177",
            "source_id": 1,
            "headquarters": 1,
            "research_and_development": 1,
            "manufacturing": 1,
            "distribution": 1,
            "sales": 1,
            "retail": 1
        }
    ],
    "contacts": [
        {
            "title": "Contact Title",
            "description": "The contact description.",
            "person": "A Person\u0027s Name",
            "position": "The Person\u0027s Position",
            "email": "email@website.com",
            "phone": "858-234-5432",
            "fax": "555-666-7777",
            "raw_address": "7900 Durand Ave. Sturtevant, WI 53177",
            "source_id": 1
        }
    ],
    "industries": [
    	{
    		"term_id": 1,
    		"score": 42,
    		"raw_score": 42,
    		"verified": 1,
    		"source_id": 1
    	}
    ],
    "business_types": [
    	{
    		"term_id": 1,
    		"score": 42,
    		"raw_score": 42,
    		"verified": 1,
    		"source_id": 1
    	}
    ],
    "certifications": [
    	{
    		"term_id": 1,
    		"score": 42,
    		"raw_score": 42,
    		"verified": 1,
    		"source_id": 1
    	}
    ],
    "subcategories": [
    	{
    		"term_id": 1,
    		"score": 42,
    		"raw_score": 42,
    		"verified": 1,
    		"source_id": 1
    	}
    ],
    "states_serviced": [
    	{
    		"term_id": 1,
    		"score": 42,
    		"raw_score": 42,
    		"verified": 1,
    		"source_id": 1
    	}
    ],
    "countries_serviced": [
    	{
    		"term_id": 1,
    		"score": 42,
    		"raw_score": 42,
    		"verified": 1,
    		"source_id": 1
    	}
    ],
    "social_links": [
        {
            "title": "Social Link Title",
            "url": "http://www.website.com",
            "score": 42,
            "verified": 1,
            "source_id": 1
        }
    ]
}
'
```

### Create a Contact ( POST )
Make a POST request to `/companies/contacts/` and append a data package consisting of a JSON Contact object. 

#### Create a Contact Fields

- `id` *ignored*
- `source_id` *required* *must exist*
- `company_id` *required* *must exist*
- `title`
- `description`
- `person`
- `position`
- `email`
- `phone`
- `fax`
- `raw_address`

#### Create a Contact Duplicate Prevention
The API will attempt to find duplicate contacts for the specified company before creating a new contact. It does this by comparing the contact submitted for creation to all existing contacts for that company.  If all the supplied fields are exactly the same as the exisiting fields ( or the exisiting fields are NULL ) for an existing contact, contact creation will fail.

- Example: A contact exists that has a `title` with a value of "Headquarters" and a NULL value for `person`. A new contact is submitted for creation.  The new contact has a `title` with the value of "Headquarters" and a `person` with the value of "John". Contact creation will fail as the exisiting contact should be updated with the new `person`.
- Example: A contact exists that has a `title` with a value of "Headquarters" and a `person` with the value of "John". A new contact is submitted for creation. The new contact has a `title` of "Headquarters" and a `person` with the value of `Andrea`.  Contact creation will succeed as the exisiting contact is different from the new contact, even though they share some values.

#### Create a Contact cURL Example

```
curl -H "Expect:" -u user:pass -X POST 'http://api.privatecortex.com/companies/contacts/' -d '
{
	"source_id": 1,
	"company_id": 145,
    "title": "Contact Title",
    "description": "The contact description.",
    "person": "A Person\u0027s Name",
    "position": "The Person\u0027s Position",
    "email": "email@website.com",
    "phone": "858-234-5432",
    "fax": "555-666-7777",
    "raw_address": "7900 Durand Ave. Sturtevant, WI 53177"
}
'
```

### Create a Location ( POST )
Make a POST request to `/companies/locations/` and append a data package consisting of a JSON Location object. 

#### Create a Location Fields

- `id` *ignored*
- `source_id` *required* *must exist*
- `company_id` *required* *must exist*
- `title`
- `description`
- `raw_address` *required*
- `headquarters`
- `research_and_development`
- `manufacturing`
- `distribution`
- `sales`
- `retail`

#### Create a Location Duplicate Prevention
The API will attempt to find duplicate locations for the specified company before creating a new location. It does this by comparing the location submitted for creation to all existing locations for that company. If all the supplied fields are exactly the same as the exisiting fields ( or the exisiting fields are NULL ) for an existing location, location creation will fail.

Location types ( eg. `headquarters`, `sales`, etc. are not compared ).  If other fields submitted for a new location match an exisiting location, then the exisiting location should be updated with the proper location types.

- Example: A location exists that has a `raw_address` with a value of "321 West Ave." and a NULL value for `title`. A new location is submitted for creation.  The new location has a `raw_address` with the value of "321 West Ave." and a `title` with the value of "Main Office". Contact creation will fail as the exisiting location should be updated with the new `title`.
- Example: A location exists that has a `raw_address` with a value of "321 West Ave." and a `title` with the value of "Main Office". A new location is submitted for creation. The new location has a `raw_address` with a value of "321 West Ave." and a `title` with the value of "Sales & Marketting Headquarters". Location creation will succeed as the exisiting location is different from the new location, even though they share some values.

#### Create a Location cURL Example

```
curl -H "Expect:" -u user:pass -X POST 'http://api.privatecortex.com/companies/locations/' -d '
{
	"company_id": 145,
    "title": "Location Title",
    "description": "The location description.",
    "raw_address": "7900 Durand Ave. Sturtevant, WI 53177",
    "headquarters": 1,
    "research_and_development": 1,
    "manufacturing": 1,
    "distribution": 1,
    "sales": 1,
    "retail": 1,
	"source_id": 1
}
'
```

### Create a Social Link ( POST )
Make a POST request to `/companies/social_link/` and append a data package consisting of a JSON Social Link object. 

#### Create a Social Link Fields

- `id` *ignored*
- `source_id` *required* *must exist*
- `company_id` *required* *must exist*
- `title` *required*
- `url` *required*
- `score`
- `verified`
- `last_updated` *ignored* *generated by the API*

#### Create a Social Link Duplicate Prevention
The API checks for duplicate Social Links before creating a new one.  Creation will fail if the specified combination of `company_id` and `url` already exists.

#### Create a Social Link cURL Example

```
curl -H "Expect:" -u user:pass -X POST 'http://api.privatecortex.com/companies/social_links/' -d '
{
	"source_id": 1,
	"company_id": 145,
	"title": "Social Link Title",
	"url": "http://www.website.com",
	"score": 42,
	"verified": 1
}
'
```

### Create an Industry ( POST )
Make a POST request to `/companies/industries/` and append a data package consisting of a JSON Industry object. 

#### Create an Industry Fields

- `source_id` *required* *must exist*
- `company_id` *required* *must exist*
- `term_id` *required* *must exist*
- `score`
- `verified`
- `last_updated` *generated by the API* *ignored* *controlled by the api*
- `num_docs`
- `num_words`
- `num_doc_matches`
- `num_word_matches`
- `raw_score`
- `normalized_score`

#### Create an Industry Duplicate Prevention
The API checks for duplicate Industries before creating a new one.  Creation will fail if the specified combination of `company_id` and `term_id` already exists.

#### Create an Industry cURL Example

```
curl -H "Expect:" -u user:pass -X POST 'http://api.privatecortex.com/companies/industries/' -d '
{
  "source_id": 1,
  "company_id": 145,
  "term_id": 12,
  "score": 42,
  "verified": 1,
  "raw_score": 42,
  "num_docs": 10,
  "num_words": 10271,
  "num_doc_matches": 3,
  "num_word_matches": 14
}
'
```

### Create a Certification ( POST )
The same as Create an Industry, except the endpoint is `/companies/certifications/`.

### Create a Business Type ( POST )
The same as Create an Industry, except the endpoint is `/companies/business_types/`.
- Creating Manufacturing and Diversity Business Types are done through this endpoint, and cannot be done seperately.

### Create a Category ( POST )
*not available in V1.0*
The same as Create an Industry, except the endpoint is `/companies/categories/`.

### Create a Subcategory ( POST )
The same as Create an Industry, except the endpoint is `/companies/subcategories/`.

### Create a City Serviced ( POST )
*not available in V1.0*
The same as Create an Industry, except the endpoint is `/companies/cities_serviced/`.

### Create a State Serviced ( POST )
The same as Create an Industry, except the endpoint is `/companies/states_serviced/`.

### Create a Country Serviced ( POST )
The same as Create an Industry, except the endpoint is `/companies/countries_serviced/`.

### Create a Source ( POST )
*not available in V1.0*


Update Company Data
-------------------

*The "expect" header needs to be disabled with large data packages ( Lighttpd problem in V1.4 ).*

*Apostrophes should be replaced with `\u0027` in JSON passed to the API.*

### Update a Company ( PUT )
Make a PUT request to `/companies/` to update a company.

Updating a company is slightly different than creating a new company.  The API will only accept updates on individual components of the company object.  This means the main company information ( `name`, `description`, `url`, etc. ) needs to be updated in a seperate call from each location, contact, industry, etc.  This mimics normal usage of the API.

#### Update a Company Fields

- `id` *required*
- `cage_code`
- `duns_number`
- `url` requires `url_source_id` *source id must exist*
- `name` requires `name_source_id` *source id must exist*
- `legal_business_name` requires `legal_business_name_source_id` *source id must exist*
- `division` requires `division_source_id` *source id must exist*
- `description` requires `description_source_id` *source id must exist*
- `employees` requires `employees_source_id` *source id must exist*
- `sales` requires `sales_source_id` *source id must exist*
- `year_founded` requires `year_founded_source_id` *source id must exist*

#### Update a Company cURL Example

```
curl -H "Expect:" -u user:pass -X PUT 'http://api.privatecortex.com/companies/' -d '
{
	"id": 145,
    "cage_code": "abc12",
    "duns_number": 123456789,
    "url": "http://www.website.com",
    "url_source_id": 1,
    "name": "Company Name",
    "name_source_id": 1,
    "legal_business_name": "Legal Business Name",
    "legal_business_name_source_id": 1,
    "division": "Company Division",
    "division_source_id": 1,
    "description": "A company description.",
    "description_source_id": 1,
    "employees": "500 or 250-499, etc.",
    "employees_source_id": 1,
	"sales": "$10M or $10,000,000 or $10M - $25M, etc.",
    "sales_source_id": 1,
	"year_founded": 1981,
    "year_founded_source_id": 1
}
'
```

#### Update Company Source IDs

The API always compares the `source_id` of supplied data to the exisitng `source_id` for that data.  If the existing data `source_id` is a higher priority than the supplied data, the PUT request will fail, an error message will be returned specifying the field that could not be updated, and no company data will be updated.

#### Skip Update Company Source ID Conflicts

This endpoint can be made to simply skip the data that doesn't pass the `source_id` comparison, allowing the other supplied company data to be updated.  To do this, add the `?skip_source_id_conflicts=1` URL parameter to the request URI.  Data that cannot be updated due to a `source_id` conflict, will be silently dicarded.

### Update a Contact ( PUT )
Make a PUT request to `/companies/contacts/` to update a company contact.

#### Update a Contact Fields

- `id` *required*
- `source_id` *required* *must exist*
- `company_id` *ignored*
- `title`
- `description`
- `person`
- `position`
- `email`
- `phone`
- `fax`
- `raw_address`
- `last_updated` *ignored* *generated by the API*

#### Update a Company Contact cURL Example

```
curl -H "Expect:" -u user:pass -X PUT 'http://api.privatecortex.com/companies/contacts/' -d '
{
	"id": 1,
	"source_id": 145,
    "title": "Contact Title",
    "description": "The contact description.",
    "person": "A Person\u0027s Name",
    "position": "The Person\u0027s Position",
    "email": "email@website.com",
    "phone": "858-234-5432",
    "fax": "555-666-7777",
    "raw_address": "7900 Durand Ave. Sturtevant, WI 53177"
}
'
```

### Update a Location ( PUT )
Make a PUT request to `/companies/locations/` to update a company location.

#### Update a Location Fields

- `id` *required*
- `source_id` *required* *must exist*
- `company_id` *ignored*
- `title`
- `description`
- `raw_address`
- `headquarters`
- `research_and_development`
- `manufacturing`
- `distribution`
- `sales`
- `retail`
- `last_updated` *ignored* *generated by the API*

#### Update a Location cURL Example

```
curl -H "Expect:" -u user:pass -X PUT 'http://api.privatecortex.com/companies/locations/' -d '
{
	"id": 1,
    "title": "Location Title",
    "description": "A location description.",
    "raw_address": "7900 Durand Ave. Sturtevant, WI 53177",
    "headquarters": 1,
    "research_and_development": 1,
    "manufacturing": 1,
    "distribution": 1,
    "sales": 1,
    "retail": 1,
    "source_id": 145
}
'
```

### Update a Social Link ( PUT )
Make a PUT request to `/companies/social_link/` and append a data package consisting of a JSON Social Link object. 

#### Update a Social Link Fields

- `id` *required*
- `source_id` *required* *must exist*
- `company_id` *ignored*
- `title`
- `url`
- `score`
- `verified`
- `last_updated` *ignored* *generated by the API*

#### Update a Social Link cURL Example

```
curl -H "Expect:" -u user:pass -X PUT 'http://api.privatecortex.com/companies/social_links/' -d '
{
	"source_id": 1,
	"id": 123,
	"title": "Social Link Title",
	"url": "http://www.website.com",
	"score": 42,
	"verified": 1
}
'
```

### Update an Industry ( PUT )
Make a PUT request to `/companies/industries/` to update a company industry.

The `company_id` and `term_id` are used to identify the record you are updating. Only the `score` and `verified` fields can be updated. You will need to delete a record, then create a new record if the `company_id` or `term_id` needs to change for a record.

#### Update Industry Fields

- `source_id` *required* *must exist*
- `company_id` *required* *must exist*
- `term_id` *required* *must exist*
- `score`
- `raw_score`
- `verified`
- `last_updated` *ignored* *generated by the API*

#### Update an Industry cURL Example

```
curl -H "Expect:" -u user:pass -X PUT 'http://api.privatecortex.com/companies/industries/' -d '
{
	"source_id": 1,
	"company_id": 145,
	"term_id": 12,
	"score": 42,
	"raw_score": 42,
	"verified": 1
}
'
```

### Update a Certification ( PUT )
The same as Update an Industry, except the endpoint is `/companies/certifications/`.

### Update a Business Type ( PUT )
The same as Update an Industry, except the endpoint is `/companies/business_types/`.
- Creating Manufacturing and Diversity Business Types are done through this endpoint, and cannot be done seperately.

### Update a Category ( PUT )
*not available in V1.0*
The same as Update an Industry, except the endpoint is `/companies/categories/`.

### Update a Subcategory ( PUT )
The same as Update an Industry, except the endpoint is `/companies/subcategories/`.

### Update a City Serviced ( PUT )
*not available in V1.0*
The same as Update an Industry, except the endpoint is `/companies/cities_serviced/`.

### Update a States Serviced ( PUT )
The same as Update an Industry, except the endpoint is `/companies/states_serviced/`.

### Update a Countries Serviced ( PUT )
The same as Update an Industry, except the endpoint is `/companies/countries_serviced/`.

### Update a Source ( PUT )
*not available in V1.0*


COMPANY SEARCH
==============

### Making a Company Search Request

- Make a GET request to `/companies/search/` and append the appropriate search parameters ( query, filters, facets, etc. ).
- Specify search parameters in the uri of the search request.
	- `/companies/search/?query=term&limit=25`

### Allowed Search Parameters

- `fields`
- `limit`
- `offset`
- `query`
- `filters`
- `geo_filter`
- `facets`

### Combining Search Parameters

- Search parameters can be combined into a single request or made individually.
- Query and Filter combinations are always wrapped in an AND request, meaning results will match the Query and the Filters.  OR requests can be mimicked by making multiple requests and combining the results client side.
- Facets are based on the results from any Queries or Filters specified in the request.  If no Query or Filters are specified, Facets will be calculated for all companies.

### Example Search Request

#### Request URI
`/companies/search/?query=adhesive&fields=name,description&limit=25&offset=75&filters=states:or:("california","maryland"),industries:or:("aerospace","defense")&geo_filter=25mi,41,-82&facets=business_types`

#### Resulting Elasticsearch Request

*for referece only* The Elasticsearch query cannot be set directly. This is provided for reference to get a better sense for how Elasticsearch is being queried, and how that might affect search results.

```
{
    "fields": [
        "name",
        "description"
    ],
    "from": 75,
    "size": 25,
    "facets": {
        "business_types": {
            "terms": {
                "field": "business_types.term.not_analyzed"
            }
        }
    },
    "query": {
        "filtered": {
            "filter": {
                "and": [
                    {
                        "terms": {
                            "_cache": true,
                            "execution": "or",
                            "locations.state": [
                                "california",
                                "maryland"
                            ]
                        }
                    },
                    {
                        "terms": {
                            "_cache": true,
                            "execution": "and",
                            "industries.term.not_analyzed": [
                                "aerospace",
                                "defense"
                            ]
                        }
                    },
                    {
                        "geo_distance": {
                            "locations.geolocation": {
                                "lat": "41",
                                "lon": "-82"
                            },
                            "distance": "25mi"
                        }
                    }
                ]
            },
            "query": {
                "bool": {
                    "should": [
                        {
                            "query_string": {
                                "default_field": "_all",
                                "query": "adhesive"
                            }
                        },
                        {
                            "has_child": {
                                "type": "file",
                                "query": {
                                    "query_string": {
                                        "default_field": "_all",
                                        "query": "adhesive"
                                    }
                                }
                            }
                        }
                    ],
                    "minimum_number_should_match": 1
                }
            }
        }
    }
}
```

### Example Search Response

#### Request URI

`/companies/search/?query=adhesive&fields=url,name,description&facets=industries:2&limit=2&offset=4`

#### Response

```
{
    "status": 200,
    "data": {
        "took": 32,
        "results": {
            "total": 487,
            "max_score": 2.1208248,
            "limit": "2",
            "offset": "4",
            "previous_endpoint": "http://api.privatecortex.com/companies/search/?query=adhesive&fields=url,name,description&facets=industries:2&limit=2&offset=2",
            "next_endpoint": "http://api.privatecortex.com/companies/search/?query=adhesive&fields=url,name,description&facets=industries:2&limit=2&offset=6",
            "companies": [
                {
                    "_score": 1.1966023,
                    "_endpoint": "http://api.privatecortex.com/companies/1085",
                    "id": "1085",
                    "url": "http://www.adhesivesandtapes.com/",
                    "name": "Adhesives & Tapes"
                },
                {
                    "_score": 1.0365309,
                    "_endpoint": "http://api.privatecortex.com/companies/119556",
                    "id": "119556",
                    "url": "http://www.axiommaterials.com/",
                    "name": "AXIOM MATERIALS Inc.",
                    "description": "Prepreg suppliers, Axiom Materials also manufactures film adhesives and ancillary products for the aerospace, defense, new energy, automotive, industrial and medical Industries. We manufacture prepregs up to 62\" width: carbon, fiberglass, epoxy, aramid and more."
                }
            ]
        },
        "facets": {
            "industries": {
                "missing": 14,
                "total": 6499,
                "other": 5800,
                "terms": [
                    {
                        "term": "Plastics",
                        "count": 398
                    },
                    {
                        "term": "Electronics",
                        "count": 301
                    }
                ]
            }
        }
    }
}
```


Fields Parameter
----------------

- The fields parameter allows the client to specify what company data to return with search results.  List one or more, seperated by commas, using the `fields=` uri parameter.
	- `/companies/search?query=term&fields=name,url,description`
- By default, the company `id` and `endpoint` ( The Company Profile API URL ) will always be returned with search results.  These fields never need be specified in a search request.
- Specifying fields to return often prevents many additional requests to the API to get additional company data.
- Company data returned from the search endpoint is not always the most current ( although it usually is ).  The company profile endpoints are the definitive data source.

### Available Fields to Request

- `id` *always returned*
- `endpoint` *always returned*
- `cage_code`
- `url`
- `name`
- `description`
- `contacts` *not available in V1.0*
- `locations` *not available in V1.0*
- `business_types`
- `certifications`
- `industries`
- `terms`
- `categories` *not available in V1.0*
- `subcategories`
- `cities_serviced` *not available in V1.0*
- `states_serviced`
- `countries_serviced`


Limit Results Parameter
-----------------------

`/companies/search?query=term&limit=20`

- A limit is not required.
- 10 results will be returned by default.
- The specified `limit` must be a number between 1 and 250 ( inclusive )


Offset Results Parameter
------------------------

`/companies/search?query=term&offset=10`

- An `offset` is not required.
- Queries will return the first 10 results by default ( documents 0 through 9 ). This is the same as specifying an `offset` of 0.
- Subsequent result sets can be requested by specifying an `offset` field in the URI request. The value specified represents the first document in the result set to return. eg. To get documents 10 through 19, specify an `offset` of 10.


Query Parameter
---------------

### Term Queries ( GET )
`/companies/search?query=any of these terms`

### Phrase Queries ( GET )
`/companies/search?query="this exact phrase"`

### Advanced Queries ( GET )

```
companies/search
	?query="this exact phrase" AND ( any of these terms )
	?query="this exact phrase" OR ( any of these terms )
	?query=( any of these terms ) AND ( "this exact phrase" OR "this other exact phrase" )
```

- Query logic can be as complex as needed, but query length and complexity greatly impact search efficiency.
- Nested parentheses are allowed in search logic.

### Query Result Ranking

- Queries are matched against company profiles and associated files.
- Queries are matched against all indexed fields.
- Appropriate weighting is applied to all fields when data is indexed.
- Returned results must match either the company profile or an associated file.
- Companies that match both a company profile and an associated file will rank higher.


Filter Parameter
----------------
`/companies/search/?filters=states:or:("california","maryland"),industries:or:("aerospace","defense"),certifications:not:("iso 9001")`

- Filters are applied to all companies.
- One or many filters can be made in a single request.
- Filters will be executed before a query to limit the load on the search server.
- *The API does not validate the existence of filter values ( eg. zip codes, state names, etc. ).*
	- If a filter value is specified that does not exist, the system return zero results ( eg. `?filters=states:("kalamazoo")` ).

### Multiple Filters

When multiple filters are specified, they are all wrapped in an AND request. An OR request can be mimicked by making multiple requests and combining the results client side. In the example above, results will include only companies that have locations in California OR Maryland AND service the Aerospace OR Defense industries AND are not ISO 9001 certified.

### Location Filters

Location Filters are matched against the address of physical company locations.

- `postal_codes`
	- US zip codes only.
	- 5 numeric digits only.
- `cities`
	- To be more explicit, combine with a state filter.
- `city_codes`
- `counties`
	- Never include the word "county".
- `county_codes`
- `districts`
- `district_codes`
- `states`
	- Use full state name.
- `state_codes`
- `countries`
	- United States is currently "us".
	- Other names have not been standardized yet.
- `country_codes`

### Locations Serviced Filters

- `cities_serviced` *not available in V1.0*
- `states_serviced`
- `countries_serviced`

### Classification Filters

- `categories` *not available in V1.0*
- `subcategories`
- `terms` *disabled in V1.0 ( too resource intensive )*
- `industries`
- `business_types`
- `certifications`


Ranged Geolocation Filter Parameter
-----------------------------------

Geolocation filters can be applied using a US five digit zip code or Lat / Lon coordinates.  In both cases, a range must be specified in miles (mi) or kilometers (km).  Specify the range first, followed by Lat/Lon or a US Zip Code.  Seperate values with a comma.

`/companies/search/?geo_filter=:range,[:postal_code OR :lat,:lon]`

### Range
A range must be specified as miles ( mi ) or kilometers ( km ), and can be any value from 1 to really big.

### Ranged Lat / Lon Filter
Lat and Lon values should be positive or negative numbers containing zero to six decimal places.

```
companies/search/?geo=25mi,41,-82
companies/search/?geo=50km,41.1456,-82.1456
```

### Ranged Postal Code Filter
*under development*

US Zip Codes must be a five digits.

`/companies/search/?postal_code_filter=25mi,92101`


Facet Parameter
---------------

- Make a GET request to `/companies/search/` and append `?facets=` to return facetted results.
- Specify a facet type and the nubmer of facet results you'd like returned.
	- 10 facet results will be returned by default ( no size specified )
	- Facet size can range from 0 to 250
	- Facet results can be ordered by `count` ( default ), `reverse_count`, `term`, and `reverse_term`
	- `/companies/search/?facets=industries:25:term`
- One or more facet fields can be specified ( seperate with commas ).
	- `/companies/search/?facets=industries:25:term,business_types`
- When combined with a query and/or filters, the facetted result set will be limited to the result set returned by the query and/or filters.  Facets do not affect query or filter results in any way.

### Available Facet Fields

#### Meta Data
- `terms` *disabled*
	- this is currenlty too resource intensive.
- `categories` *not available in V1.0*
- `subcategories`
- `industries`
- `business_types`
- `certifications`

#### Locations Serviced
- `cities_serviced` *not available in V1.0*
- `states_serviced`
- `countries_serviced`

#### Has Physical Location
- `cities`
- `counties`
- `districts`
- `states`
- `countries` *not available in V1.0*
- `zip` *not planned*
	- not sure this is a useful facet
	- it's also a particularly resource intensive
	

Company Utilities
==================

*These endpoint should only be used by internal systems and are not available to most API clients.*

These endpoints are generally used by other Cortex systems to operate and monitor their respective applications.  For example, the Company Crawler uses the `/companies/next_to_crawl/` endpoint to choose the next company to crawl.  When it's done crawling, it uses the `/companies/crawled/:id` endpoint to update the system.  The API takes care of the details of selecting a company to crawl ( eg. managing the queue, marking companies as `crawling`, writing crawl logs, etc. ), and the details of finishing a crawl ( eg. marking a company as not `crawling`, logging the crawl date, etc. ).


Crawling Utilities
------------------

### Populate Crawler Queue ( PUT )
Make a PUT request to `/companies/populate_crawler_queue/:num`. The API will select the next companies to crawl, set them as `queued_for_crawling`, and set the `last_queued_for_crawling` time.  The number of companies to queue must be specified with `$num` in the URL.  The maximum number of companies that can be queued at once is 1,000.


### Get Next To Crawl ( PUT )
Make a GET request to `/companies/next_to_crawl/`.  The API selects the next company to crawl, sets it as `crawling`, and returns the `company_id`, the `crawler_queue_message_id`, and the `crawler_queue_message_receipt_handle`.  The Crawler Queue Message will be hidden from other processes for 30 minutes.  The `crawler_queue_message_receipt_handle` is required to delete queue messages using the `/companies/crawled/` endpoint.


### Set As Crawled ( PUT )
Make a PUT request to `/companies/crawled/:id/:crawler_queue_message_receipt_handle/` and append a company `id` and the associated `crawler_queue_message_receipt_handle`. The API will set the company as `crawling` = 0, `queued_for_crawling` = 0, `last_crawled` datatime as the current database server datetime, and delete the specified Crawler Queue Message.  An HTTP Status of `200` will be returned on success.

*The `crawler_queue_message_receipt_handle` must be URL Encoded.*


Indexing Utilities
------------------

### Populate Indexer Queue ( PUT )
Make a PUT request to `/companies/populate_indexer_queue/:num`. The API will select the next companies to index, set them as `queued_for_indexing`, and set the `last_queued_for_indexing` time.  The number of companies to queue must be specified with `$num` in the URL.  The maximum number of companies that can be queued at once is 1,000.


### Index A Company ( PUT )
Make a PUT request to `/companies/index/:id`.  A company `id` is optional.  If one is set, that company will be indexed ( or re-indexed ).  If no company `id` is specified, the API will choose the next company to index from the SQS Indexing Queue.  While a company is being indexed, `indexing` will be set to 1.  When indexing is complete, `indexing` will be set to 0, `indexed` will be set to 1, `queued_for_indexing` will be set to 0, `last_indexed` will be updated with the current database server date and time, and the Indexer SQS Queue Message for this company will be deleted.  An HTTP Status of `200` will be returned on success.

#### Select The Next Company
If no company `id` is specified, the API will choose a company that:
- is not currently being indexed
- has a value of 1 for `index`
- has a `last_crawled` date that is newer than the `last_indexed` date

#### Indexing Company Files
A company's files can be indexed by appending `?fields=files` to the request uri.  When complete, each file will have `indexed` set to 1 and `last_indexed` updated with the current date and time.  If the company's `last_indexed` date is more recent than the `last_crawled` date, files will not be indexed.

#### Indexing HTTP Response Status Codes
- `200` The next company was succesfully indexed.
- `202` There are no companies queued for indexing. The request was succesful, but nothing was done.  Try popualting the queue ( /comapnies/populate_indexer_queue/:num ).


### De-Index A Company ( DELETE )
Make a DELETE request to `/companies/deindex/:id` and append a company `id`.  The company will be deleted from the search index and updated as not `indexed` and no `index` in the master database.  The API will return a `204` on success.

#### De-Index Company Files
A company's files can be de-indexed by appending `?fields=files` to the request uri.  When complete, each file will be removed from the search index, and have `indexed` set to 0 in the master database.


Geocoding Utilities
-------------------

### Geocode Company Contacts ( PUT )
Make a PUT request to `/companies/geocode/contacts/`.  This endpoint looks for Contacts with addresses that have not been geocoded yet, or have been updated since they were last geocoded.  Those addresses are then passed to our Geocoding server and the expanded address data is updated for that Contact.  This endpoint geocodes the next 25 contacts in the queue.  Subsequent requests will geocode more.

After each contact is geocoded, it's field `last_geocoded` is updated with the current time.  The associated company's field `last_geocoded` is also updated with the current time.

### Geocode Company Locations ( PUT )
Behaves the sames as Geocode Company Contacts except the PUT request is made to `/companies/geocode/locations/`.


Other Utilities
---------------

### Get Potential Duplicate Companies ( POST )
Make a POST request to `/companies/duplicates/`, specify the fields to compare in the URI `?fields=name,url`, and append a JSON company object containing at least the fields to compare as the Request Body.

The API will return an array containing the `id` and the specified fields ( eg. `name` and `url` ) of any companies that are considered potential duplicates ( as a minimal but properly formatted company object ).  If no duplicates were found, an empty array is returned.

*Returned companies are not necesarilly duplicates.* Multiple companies in the world could have the same name. This endpoint is generally the best duplicate protection the API can offer when doing bulk imports.

#### Fields To Compare By
- `name` *required for all requests*
- `url`

#### Logic When Comparing By `name`
The supplied company name is compared to every company name in the system.  Companies whose names match the supplied `name` exactly will be returned as potential duplicates. *would like to add filtering for things like inc., ltd., etc.*

#### Logic When Comparing By `name` and `url`
If the supplied subdomain.domain combo ( obtained from the specified `url` ) matches any companies already in the system, the API will compare those company names to the company name provided using a Lavenstien function. If the name is considered similar, company creation will fail. Names are considered similar if half of the longest company name is the same as the shorter name.

#### Get Potential Duplicate Companies cURL Example

```
curl -H "Expect:" -u user:pass -X POST 'http://api.privatecortex.com/companies/duplicates/?fields=name,url' -d '
{
	"name": "Company Name",
	"url": "http://www.company_website.com"
}
'
```


Company Files
=============
*Apostrophes should be replaced with `\u0027` in JSON passed to the API.*

The File Object
---------------

- `id` *bitint 20*
- `company_id` *int 11*
- `url` *varchar 255*
- `title` *text ( 65,535 Characters )*
- `description` *text ( 65,535 Characters )*
- `keywords` *text ( 65,535 Chracters )*
- `terms` *array*
	- This field is an aggregation of terms from various sources for the purpose of filtering and facetting. It only exists in Elasticsearch and cannot be updated in the file object.  It is returned when requesting a File object, however.
	- This field contains: terms extracted from meta `keywords`, `anchor_texts`, `h1_tags`, `h2_tags`, `h3_tags`, and `url_words`.
- `h1_tags` *array*
- `h2_tags` *array*
- `h3_tags` *array*
- `anchor_texts` *array*
- `url_words` *array*
- `min_price` *dec 11,2*
- `max_price` *dec 11,2*
- `avg_price` *dec 11,2*
- `tier` *smallint 5*
- `content_type` *MIME Content Type*
- `encoding` *Character Encoding Type*
- `source_id` *int 11*

#### specific to image files
- `height` *smallint 5*
- `width` *smallint 5*
- `entropy` *float 5,2*
	- a calculated value representing image complexity
	- a web graphic will generally have a low entropy, while a photograph will have a high entropy

#### internal file processing data
*These fields are generally only available via GET requests.*

- `processed` *bool*
- `last_processed` *datetime*
- `indexed` *bool*
- `last_indexed` *datetime*
- `junk` *tinyint 1*
- `last_junked` *datetime*
- `private` *bool*


Get File Data
-------------

### Get A Basic File Profile ( GET )
Make a GET request to `files/:id` and append a file `id`. 

File IDs can be obtained from the company profile endpoint by adding the uri parameter `fields=files`

### Get A Detailed File Profile ( GET )
Make a GET request to `files/:id`, append a file `id`, and append `fields` to the URI request ( eg. `/files/:id?fields=images` ).

#### Detailed File Fields

- Fields should be supplied as a comma deliminated list with no spaces.
- Fields can be specified individually or together, and in any order.
- Allowed Fields:
	- `images`
		- Returns an array of image file IDs related to this file.
		- The image files must be loaded individually via the `files/:id` endpoint.
		- *consider doing a join with the files table and return the s3_url, thumbnails, etc.*

File Utilities
--------------
*These endpoint should only be used by internal systems and are not be available to most API clients.*

### Index a File ( PUT )
Make a PUT request to `/files/index/:id`.  The specified file will be indexed, `indexed` will be set to 1, and `last_indexed` will be updated with the current date and time.

### De-Index a File ( DELETE )
Make a DELETE request to `/files/deindex/:id` and append a company `id`.  The file will be deleted from the search index and `indexed` will be set to 0.  The API will return a `204` on success.


Geocoding 
==========

### Geocode an Address ( GET )
Make a GET request to `/geocode/:raw_address`.  The `raw_address` should be URL Encoded.  The API will return a properly formatted raw address, and it's components, including Lat and Lon.  This data will not be stored anywhere by the API.

### Geocode Company Addresses
*See the `/companies/geocode/` endpoint.*


Terms
=====

Get Term Data
-------------

### Term Profile ( GET )
*not available in V1.0*

An `id` or the specific `term` name can be specified to request a term profile.

```
terms/:id
terms/:term
```

### Term Search ( GET )
*not available in V1.0*


DLA NSNs
========
*disabled*

DLA SOLICITATIONS
=================
*disabled*
